<!DOCTYPE HTML>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<title>Project 2</title>
		<script type="text/javascript" src="https://www.google.com/jsapi"></script>
	</head>

	<body>



	<div class="header">
	<h2>Heroin: A Scourge on Society</h2>
	by Nicolas Aguirre
	</div>

	<div class="story">
	<p>
	<h2>Project Overview</h2><hr>

	<p>
		Project 2 will visualize data relating to the chemical diacetylmorphine, more commonly known as "heroin." The project aims to divulge trends in consumption, demographics of use, geographic trends (with focus on the U.S.), death toll and other relevant data. The idea is to give the audience an article that they can read in 10-15 minutes and have a good understanding of the issue at hand.
	</p>
	<br>

	<h3>Style</h3>
	
	<p>
		Due to the nature its subject matter, this project strives for seriousness. Stylistic components will be restained for the most part, though creative flair may emerge where necessary. Graphical components will focus on function rather than form. The style should tell a story accurately while presenting data in a meaningful, comprehensible format.
	</p>
	<br>

	<h3>Client</h3>
	
	<p>
		The client would ideally be an NGO. Some that come to mind are:
		<ul>
			<li><a href="http://www.samhsa.gov/data/">SAMHSA</a> (Substance Abuse and Mental Health Services Administration)</li>
			<li><a href="http://www.cdc.gov/datastatistics/">CDC</a> (Center for Disease Control)</li>
			<li><a href="http://www.drugabuse.gov/">NIDA</a> (National Institute on Drug Abuse)</li>
			<li><a href="http://www.bjs.gov/index.cfm?ty=dca">BJS</a> (Bureau of Justice Statistics)</li>
			<li><a href="http://www.unodc.org/unodc/en/data-and-analysis/WDR-2012.html">UNODC</a> (United Nations Office on Drugs and Crime)
			</li>
		</ul>

		These will also serve as key data sources as they publish major reports regarding crime, drug abuse, and mental health issues.

		The graphic is intended to present readers with educational information that reveals the devastating societal damage caused by the production and consumption of heroin.
	</p>
	<br>

	<h3>Format</h3>
	
	<p>
		This story will exist as a webpage with charts, maps, and possibly interactive components (depending on availability of data). 
	</p>
	</div>

	<div class="story">
	<h2>Core Components</h2><hr>
	
	<p>
	This section represents the key elements that will comprise the project. This is intended serve as a schematic for what data will be visualized, and the general composition of the project
	</p>

	<h3>What is Heroin?</h3>
	<p>
	A brief narrative that explains the drug in question. Mechanism of action will be covered briefly.
	</p>
	
	<h2>Race Distribution</h2>
	<div id="hrace"></div>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script>

	// Set up margins
	var margin = {top: 20, right: 100, bottom: 30, left: 40},
	    width = 600 - margin.left - margin.right,
	    height = 300 - margin.top - margin.bottom;

	// Set up axes and color scale
	var x = d3.scale.ordinal()
	    .rangeRoundBands([0, width], .2);

	var y = d3.scale.linear()
	    .rangeRound([height, 0]);

	var color = d3.scale.ordinal()
	    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b"]);

	var xAxis = d3.svg.axis()
	    .scale(x)
	    .orient("bottom");

	var yAxis = d3.svg.axis()
	    .scale(y)
	    .orient("left")
	    .ticks(4)
	    .tickFormat(d3.format(".2s"));

	// Build container from div
	var svg = d3.select("#hrace").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	  .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	d3.csv("data/hrace.csv", function(error, data) {
	  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "Year"; }));

	  data.forEach(function(d) {
	    var y0 = 0;
	    d.races = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
	    d.total = d.races[d.races.length - 1].y1;
	  });

	  x.domain(data.map(function(d) { return d.Year; }));
	  y.domain([0, d3.max(data, function(d) { return d.total; })]);

	  svg.append("g")
	      .attr("class", "x axis")
	      .attr("transform", "translate(0," + height + ")")
	      .call(xAxis);

	  svg.append("g")
	      .attr("class", "y axis")
	      .call(yAxis)
	    .append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 6)
	      .attr("dy", ".71em")
	      .style("text-anchor", "end")
	      .text("Percent Distribution");

	  var year = svg.selectAll(".year")
	      .data(data)
	    .enter().append("g")
	      .attr("class", "g")
	      .attr("transform", function(d) { return "translate(" + x(d.Year) + ",0)"; });

	  year.selectAll("rect")
	      .data(function(d) { return d.races; })
	    .enter().append("rect")
	      .attr("width", x.rangeBand())
	      .attr("y", function(d) { return y(d.y1); })
	      .attr("height", function(d) { return y(d.y0) - y(d.y1); })
	      .style("fill", function(d) { return color(d.name); });

	  // Legend
	  var legend = svg.selectAll(".legend")
	      .data(color.domain().slice().reverse())
	    .enter().append("g")
	      // .attr("class", "legend")
	      .attr("transform", function(d, i) { return "translate(80," + i * 20 + ")"; });

	  legend.append("rect")
	      .attr("x", width - 18)
	      .attr("width", 18)
	      .attr("height", 18)
	      .attr("id", function(d, i) { return "legend-" + i;})
	      .style("fill", color);

	  legend.append("text")
	      .attr("x", width - 24)
	      .attr("y", 9)
	      .attr("dy", ".35em")
	      .style("text-anchor", "end")
	      .text(function(d) { return d; });

	  legend.on("mouseover", function(d, i) {
	  	d3.select("#legend-" + i).style("fill","red");
	  });

	  legend.on("mouseout", function(d, i) {
	  	d3.select("#legend-" + i).style("fill", color);
	  });

	});


	</script>

	<h2>Age Distribution</h2>
	<div id="hage"></div>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script>

	//Set up axes
	var x2 = d3.scale.ordinal()
	    .rangeRoundBands([0, width], .2);

	var y2 = d3.scale.linear()
	    .rangeRound([height, 0]);

	var color2 = d3.scale.ordinal()
	    .range(["#98abc5", "#8a89a6", "#7b6888"]);

	var xAxis2 = d3.svg.axis()
	    .scale(x2)
	    .orient("bottom");

	var yAxis2 = d3.svg.axis()
	    .scale(y2)
	    .orient("left")
	    .ticks(4)
	    .tickFormat(d3.format(".2s"));

	// Build container from div
	var svg2 = d3.select("#hage").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
	  .append("g")
	    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	d3.csv("data/hage.csv", function(error, data) {
	  color2.domain(d3.keys(data[0]).filter(function(key) { return key !== "Year"; }));

	  data.forEach(function(d) {
	    var y0 = 0;
	    d.ages = color2.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
	    d.total = d.ages[d.ages.length - 1].y1;
	  });

	  x2.domain(data.map(function(d) { return d.Year; }));
	  y2.domain([0, d3.max(data, function(d) { return d.total; })]);

	  svg2.append("g")
	      .attr("class", "x axis")
	      .attr("transform", "translate(0," + height + ")")
	      .call(xAxis2);

	  svg2.append("g")
	      .attr("class", "y axis")
	      .call(yAxis2)
	    .append("text")
	      .attr("transform", "rotate(-90)")
	      .attr("y", 6)
	      .attr("dy", ".71em")
	      .style("text-anchor", "end")
	      .text("Percent Distribution");

	  var year2 = svg2.selectAll(".year")
	      .data(data)
	    .enter().append("g")
	      .attr("class", "g")
	      .attr("transform", function(d) { return "translate(" + x2(d.Year) + ",0)"; });

	  year2.selectAll("rect")
	      .data(function(d) { return d.ages; })
	    .enter().append("rect")
	      .attr("width", x2.rangeBand())
	      .attr("y", function(d) { return y2(d.y1); })
	      .attr("height", function(d) { return y2(d.y0) - y2(d.y1); })
	      .style("fill", function(d) { return color2(d.name); });

	  // Legend
	  var legend2 = svg2.selectAll(".legend")
	      .data(color2.domain().slice().reverse())
	    .enter().append("g")
	      // .attr("class", "legend")
	      .attr("id", function(d, i) { return "legend-" + i;})
	      .attr("transform", function(d, i) { return "translate(80," + i * 20 + ")"; });

	  legend2.append("rect")
	      .attr("x", width - 18)
	      .attr("width", 18)
	      .attr("height", 18)
	      .style("fill", color2);

	  legend2.append("text")
	      .attr("x", width - 24)
	      .attr("y", 9)
	      .attr("dy", ".35em")
	      .style("text-anchor", "end")
	      .text(function(d) { return d; });

	});

	
	</script>
	
	</p>
	<br><br>
	<p>
	Users by Frequency:
	<br><br>
	<img src="pic/users-frequency.png">
	</p>

	<h3>Consumption, Production, and Transportation</h3>
	<p>
	This section will contain key statistics and information that illustrates the volume of the heroin market. Much of this information is available from a <a href="http://www.unodc.org/documents/wdr2014/World_Drug_Report_2014_web.pdf">report</a> published by the UNODC.

	<br><br>
	<h3>Prevalence of Opiate (Heroin and Opium-Derived) Use (Ages 12-70):</h3>
	<br><br>

	<!-- Choropleth goes here -->

    <script type="text/javascript">
      google.load("visualization", "1", {packages:["geochart"]});
      google.setOnLoadCallback(drawRegionsMap);

      function drawRegionsMap() {

        var data = google.visualization.arrayToDataTable([
	     	['Country', 'Prevalence'],
            ['Kenya', 0.22],
			['Mauritius', 0.91],
			['Rwanda', 0.14],
			['Seychelles', 2.3],
			['Somalia', 0.16],
			['Uganda', 0.05],
			['Algeria', 0.06],
			['Egypt', 0.44],
			['Libya', 0.14],
			['Morocco', 0.08],
			['Tunisia', 0.12],
			['South Africa', 0.41],
			['Swaziland', 0.17],
			['Zambia', 0.37],
			['Zimbabwe', 0.04],
			['Central African Republic', 0.05],
			['Chad', 0.22],
			['Cabo Verde', 0.18],
			['Ghana', 0.14],
			['Liberia', 0.17],
			['Niger', 0.2],
			['Nigeria', 0.7],
			['Congo', 0.13],
			['Senegal', 0.08],
			['Sierra Leone', 0.17],
			['Democratic Republic of the Congo', 0.13],
			['Barbados', 0.11],
			['Dominican Republic', 0.07],
			['Haiti', 0.07],
			['Jamaica', 0.7],
			['Belize', 0.3],
			['Costa Rica', 0.09],
			['El Salvador', 0.11],
			['Guatemala', 0.04],
			['Honduras', 0.15],
			['Nicaragua', 0.02],
			['Canada', 0.4],
			['Mexico', 0.18],
			['United States of America', 0.55],
			['Argentina', 0.07],
			['Bolivia', 0.45],
			['Brazil', 0.1],
			['Chile', 0.02],
			['Colombia', 0.02],
			['Ecuador', 0.07],
			['Paraguay', 0.03],
			['Peru', 0.18],
			['Uruguay', 0.06],
			['Venezuela', 0.03],
			['Armenia', 0.16],
			['Azerbaijan', 1.5],
			['Georgia', 0.72],
			['Kazakhstan', 0.89],
			['Kyrgyzstan', 0.74],
			['Tajikistan', 0.54],
			['Turkmenistan', 0.32],
			['Uzbekistan', 0.78],
			['Cambodia', 0.03],
			['Cambodia', 0.04],
			['China', 0.25],
			['China', 0.19],
			['China, Hong Kong SAR', 0.2],
			['Indonesia', 0.11],
			['Indonesia', 0.16],
			['Laos', 0.37],
			['China, Macao SAR', 1.12],
			['Malaysia', 0.94],
			['Myanmar', 0.8],
			['Philippines', 0.04],
			['Republic of Korea', 0.2],
			['Singapore', 0.32],
			['Thailand', 0.2],
			['Viet Nam', 0.53],
			['Taiwan', 0.2],
			['Afghanistan', 2.65],
			['Iran', 2.27],
			['Israel', 0.53],
			['Kuwait', 0.17],
			['Lebanon', 0.2],
			['Pakistan', 1],
			['Saudi Arabia', 0.06],
			['Syrian Arab Republic', 0.02],
			['United Arab Emirates', 0.02],
			['Bangladesh', 0.37],
			['Maldives', 1.34],
			['Nepal', 0.24],
			['Sri Lanka', 0.33],
			['Belarus', 0.59],
			['Republic of Moldova', 0.12],
			['Russian Federation', 1.64],
			['Ukraine', 0.91],
			['Albania', 0.45],
			['Bosnia and Herzegovina', 0.3],
			['Bulgaria', 0.5],
			['Macedonia', 0.4],
			['Romania', 0.11],
			['Serbia', 0.28],
			['Czech Republic', 0.2],
			['Germany', 0.2],
			['Latvia', 0.1],
			['Liechtenstein', 0.2],
			['Poland', 0.1],
			['Switzerland', 0.1],
			['Australia', 0.2],
			['New Zealand', 0.1]
    ]);

        var options = {
        	colorAxis: {
        		colors: ['#C8B599', '#7D6A43', '#756E63'],
        		values: [0, 0.5, 2.65]
        	},
        	projection: 'kavrayskiy-vii',
        };

        var chart = new google.visualization.GeoChart(document.getElementById('regions_div'));

        chart.draw(data, options);
      }
    </script>
    <div id="regions_div" style="width: 900px"; height="500px";></div>

	</p>

	<h3>Consequences and Costs</h3>
	<p>
	This section will detail death tolls, overdoses and other societal harm done by heroin.
	<br><br>
	Overdoses:
	<br><br>
	<img src="pic/num-od.png">
	<br><br>
	Economic Cost: (All Drugs; not just Heroin)
	<br><br>
	<img src="pic/economic-cost.png">
	</p>

	</div>

	</body>

<html>